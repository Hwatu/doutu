# Repository Guidelines

## 项目结构与模块划分
- 根目录下的 `index.php` 提供核心表情生成 API，负责授权校验、样式解析与图片输出，是所有请求的唯一入口。
- `font.html` 与 `upload.html` 分别承载字体配置与上传界面；静态资源位于 `img/`（默认背景）、`fonts/`、`configs/` 与 `output/`，便于独立部署或 CDN 缓存。
- `configs/配置存放目录.txt`、`fonts/字体存放目录.txt`、`output/生成表情缓存目录.txt` 等提示文件用于说明目录用途，提交时请保留；若新增脚本，请在同级创建 README 说明。
- 推荐在新功能目录内添加 `examples/` 子文件夹收录样例配置，确保使用者能够即刻复制并二次开发。

## 构建、测试与开发命令
- `php -S 0.0.0.0:8000`：在项目根目录启动内置服务器（默认读取 `index.php`），用于本地调试前端页面与 API，另可通过 `-t public` 指定子目录。
- `curl "http://localhost:8000?ac=search&wxid=demo&keyword=hello"`：快速验证接口返回结构是否正确，可结合 `jq` 格式化响应便于调试。
- `php -l index.php`：执行语法检查，提交前务必确保无错误；复杂改动建议运行 `php -d detect_unicode=0 -l index.php` 以匹配生产环境配置，同时关注 GD 扩展加载情况。
- 若需模拟生产缓存，可临时写入 `output/` 目录并使用 `ls -lt output/ | head` 观察更新顺序，帮助定位生成延迟。

## 代码风格与命名约定
- PHP 与 HTML 文件统一使用四个空格缩进，遵循 PSR-12 的函数与变量命名（驼峰式函数、蛇形数组键），数组声明优先使用短语法。
- 所有路径常量通过 `__DIR__` 组合，避免硬编码绝对路径；新增配置项请集中在 `$config` 数组内，并撰写内联注释说明用途，便于后续维护。
- 新增前端元素命名保持语义化，例如 `data-preview`、`btn-upload`，以便在 `font.html` 中快速检索，也利于样式与脚本复用。
- 针对返回 JSON，请使用 `JSON_UNESCAPED_UNICODE` 常量保持中文可读性，避免对调用端造成额外转义负担。

## 测试指引
- 项目当前以人工回归为主：保存配置后刷新生成接口，确保 `output/` 写入文件且 JSON 响应字段齐全，可配合浏览器网络面板核对请求。
- 针对授权逻辑，建议准备 `wxid.txt` 的测试账号列表，并校验未授权场景返回的替换文案，同时记录日志便于回溯。
- 生成图片涉及文件权限，请在 macOS 或 Linux 上确认 `fonts/`、`configs/`、`output/` 均为可写；提交新功能时附带权限配置建议或脚本。
- 引入新样式参数时，请覆盖空值、极端字号、透明背景等边界情况，并附上生成截图说明差异。

## 提交与合并请求规范
- 仓库历史采用简短小写描述（示例：`first commit`），新提交沿用「动词开头 + 结果」的英文句式，如 `add font cache invalidation`，并在需要时追加范围限定（`refactor(config)`）。
- 合并请求需包含变更摘要、本地验证步骤以及必要的截图（如前端界面或生成结果）；若涉及配置格式变动，应附样例 JSON 和升级说明。
- 在 PR 描述中关联对应 issue（`Fixes #ID`），并说明对部署脚本或权限的影响，方便维护者同步更新服务器环境，同时列出回滚策略。
- 若改动触及生产目录结构，建议附带逐步部署指南及预期回滚命令，减少线下沟通成本。

## 安全与配置提示
- 提交前清除任何真实 `wxid`、字体文件或生成图片的敏感内容，示例数据请放入 `configs/example/` 子目录并添加 README 说明用途。
- 若引入外部库，请优先使用 Composer 并更新 `LICENSE` 说明；确保第三方字体版权合规，必要时附授权链接与失效应对方案。
- 提醒运营侧定期清理 `output/` 中的历史缓存，以免泄露临时素材或占用磁盘，建议通过定时任务实现自动化。
